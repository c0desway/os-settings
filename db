# install galera cluster
# https://mariadb.com/kb/en/getting-started-with-mariadb-galera-cluster/
# quick start


#
# galera cluster setup
#   : galera_new_cluster
#
#centos
curl -sS https://downloads.mariadb.com/MariaDB/mariadb_repo_setup | sudo bash
yum clean all

yum -y install MariaDB-server MariaDB-client galera-4 MariaDB-shared
yum -y install MariaDB-backup 
yum -y install MariaDB-cracklib-password-check

# init setting for galera cluster
MY_CNF=/etc/my.cnf
IP01=<GALERA_NODE_IP_01>
IP02=<GALERA_NODE_IP_02>
IP03=<GALERA_NODE_IP_03>

echo "" >> $MY_CNF
echo "[mysqld]" >> $MY_CNF
echo "binlog_format = row" >> $MY_CNF
echo "" >> $MY_CNF
echo "wsrep_on = on" >> $MY_CNF
echo "wsrep_provider = /usr/lib64/galera-4/libgalera_smm.so" >> $MY_CNF
echo "wsrep_cluster_address = 'gcomm://$IP01,$IP02,$IP03'" >> $MY_CNF

# you MUST check SHOW GLOBAL STATUS LIKE 'wsrep_cluster_size' is 1
# after the command below was started
galera_new_cluster
systemctl enable mysql

# init setting db account
drop databases test;
delete from mysql.user where user="";
flush privileges;
